
#include <../struct.h>
#include <pphdr_common.h>

sampler2D s0:register(s0);
sampler2D s1:register(s1);

half ElapsedTime;

half4 main(vs_out_pp IN) : COLOR0
{
	half AdaptedLum = (tex2D(s0, half2(0.5f, 0.5f)));
	half CurrLum = sqrt(HDRLumFloor + tex2D(s1, half2(0.5f, 0.5f)));
	
	return half4(pow( 
				pow(
					AdaptedLum, 0.25f) + ( 
											pow(CurrLum, 0.25f) - pow(AdaptedLum, 0.25f) 
										) * 
					(1.f - pow(0.98f, ElapsedTime)), 
				4.f),0,0,1);
}