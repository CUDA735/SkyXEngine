
#include <../struct.h>

sampler2D s0:register(s0);
sampler2D s1:register(s1);
static float HDRLumFloor = 0.05f * 0.05f;
float ElapsedTime;

float4 main(vs_out_pp IN) : COLOR0
{
	float AdaptedLum = (tex2D(s0, float2(0.5f, 0.5f)));
	float CurrLum = sqrt(HDRLumFloor + tex2D(s1, float2(0.5f, 0.5f)));
	//return AdaptedLum + (CurrLum - AdaptedLum) * (1.f - pow(0.98f, ElapsedTime));
	return pow( 
				pow(
					AdaptedLum, 0.25f) + ( 
											pow(CurrLum, 0.25f) - pow(AdaptedLum, 0.25f) 
										) * 
					(1.f - pow(0.98f, ElapsedTime)), 
				4.f);
}