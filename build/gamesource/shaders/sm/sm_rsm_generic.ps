
/*
sm_depth_geom_pssm_direct.ps
Рендер глубины сцены (геометрии) с позиции позиции направленного/глобального источника света
*/

#include <../struct.h>
#include <../shadow.h>

//##########################################################################

SamplerState g_sScene: register(s0);
Texture2D g_txColor: register(t0);		// basetexture

//##########################################################################

PSO_RSMbuffer main(VSO_SceneCommon IN)
{
	half4 vColor = g_txColor.Sample(g_sScene, IN.vTexUV);
	
	ShadowDepthAlphaTest(vColor);
	
	half fDepth = IN.vPos.z / IN.vPos.w;
	half fBias = ShadowSlopeBias(fDepth);
	
	PSO_RSMbuffer OUT;
	OUT.vDepth = fDepth + fBias;
	OUT.vNormal = half4(normalize(IN.vNormal), 1.0);
	OUT.vFlux = vColor /* * lightColor * angle */;
	
	return(OUT);
}
