
/*
lighting_tone_mapping.ps
Применение фильтра tone mapping
*/

#include <../struct.h>

sampler2D ColorSampler:register(s0);
sampler2D AdaptedLumSampler:register(s1);

half4 main(vs_out_pp IN):COLOR0
{
	half4 color = tex2D(ColorSampler,IN.TexUV);
	half fAdaptedLum = tex2D(AdaptedLumSampler, TexUV_Center);

	color.rgb *= TONE_MAPPING_DENOMENATOR/(fAdaptedLum + TONE_MAPPING_ADAPT_ADD_BIAS);
	color.rgb /= (fAdaptedLum + color.rgb);
	
	return color;
}