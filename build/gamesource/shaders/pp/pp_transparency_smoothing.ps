
#include <../struct.h>

sampler2D Scene:register(s0);
sampler2D Normal:register(s1);

half2 WinSize;

half4 main(vs_out_pp IN):COLOR0
{
	//return tex2Dlod(Scene, half4(IN.TexUV,0,0));
	int is_transparency = tex2Dlod(Normal, half4(IN.TexUV,0,0)).w >= 0.5 ? 1 : 0;
	
	if(!is_transparency)
		is_transparency = tex2Dlod(Normal, half4(IN.TexUV,0,0) + half4(0.0, 1.f/WinSize.y,0,0)).w >= 0.5 ? 1 : 0;
	
	if(!is_transparency)
		is_transparency = tex2Dlod(Normal, half4(IN.TexUV,0,0) + half4(1.f/WinSize.x, 0,0,0)).w >= 0.5 ? 1 : 0;
	
	if(!is_transparency)
		is_transparency = tex2Dlod(Normal, half4(IN.TexUV,0,0) + half4(1.f/WinSize.x, 1.f/WinSize.y,0,0)).w >= 0.5 ? 1 : 0;
	
	if(is_transparency)
		return bilinear(Scene, IN.TexUV,WinSize);
	else
		return tex2Dlod(Scene, half4(IN.TexUV,0,0));
}